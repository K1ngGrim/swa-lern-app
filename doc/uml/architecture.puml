@startuml LernApp
!theme plain

' Title and styling
title SmartLearn - MVC Architecture Diagram

skinparam componentStyle rectangle
skinparam linetype ortho

' ============================================
' PRESENTATION LAYER (View - Frontend)
' ============================================
package "Frontend (View Layer)" as FrontendLayer #LightBlue {
    component "Angular Application" as AngularApp {
        component "Home Component" as HomeComp
        component "Deck Page Component" as DeckComp
        component "Create Deck Component" as CreateDeckComp
        component "Statistics Component" as StatsComp
        component "Card Learning Component" as LearningComp
        
        package "Services" as FrontendServices {
            component "Deck Service" as DeckService
            component "Card Service" as CardService
            component "Progress Service" as ProgressService
            component "Auth Service" as AuthService
        }
        
        package "UI Framework" as UIFramework {
            component "Angular Material" as AngularMaterial
            component "Routing Module" as Routing
        }
    }
    
    note right of AngularApp
        **Frontend Technologies:**
        - Angular (TypeScript)
        - Angular Material
        - RxJS for reactive programming
        - HTTP Client for API calls
    end note
}

' ============================================
' APPLICATION LAYER (Controller)
' ============================================
package "Backend (Controller Layer)" as BackendLayer #LightGreen {
    component "ASP.NET Core Web API" as WebAPI {
        package "Controllers" as Controllers {
            component "UsersController" as UsersCtrl
            component "DecksController" as DecksCtrl
            component "CardsController" as CardsCtrl
            component "ProgressController" as ProgressCtrl
            component "AuthController" as AuthCtrl
        }
        
        package "Middleware" as Middleware {
            component "Authentication" as AuthMiddleware
            component "Error Handling" as ErrorMiddleware
            component "CORS Policy" as CorsMiddleware
        }
    }
    
    note right of WebAPI
        **Backend Technologies:**
        - .NET 8 / ASP.NET Core
        - REST API architecture
        - JWT Authentication
        - Entity Framework Core
    end note
}

' ============================================
' BUSINESS LOGIC LAYER (Model - Business Logic)
' ============================================
package "Business Logic (Model Layer)" as ModelLayer #LightYellow {
    component "Service Layer" as ServiceLayer {
        component "User Service" as UserService
        component "Deck Service (BL)" as DeckServiceBL
        component "Card Service (BL)" as CardServiceBL
        component "Progress Service (BL)" as ProgressServiceBL
        component "Learning Algorithm" as LearningAlgo
    }
    
    package "Domain Models" as DomainModels {
        component "User Model" as UserModel
        component "Deck Model" as DeckModel
        component "Card Model" as CardModel
        component "Progress Model" as ProgressModel
    }
    
    package "DTOs" as DTOs {
        component "Request DTOs" as RequestDTOs
        component "Response DTOs" as ResponseDTOs
    }
    
    note right of LearningAlgo
        **Spaced Repetition Algorithm:**
        - Calculates next review date
        - Adjusts difficulty based on user rating
        - Implements SM-2 or similar algorithm
    end note
}

' ============================================
' DATA ACCESS LAYER
' ============================================
package "Data Access Layer" as DataAccessLayer #LightCoral {
    component "Repository Layer" as RepositoryLayer {
        component "User Repository" as UserRepo
        component "Deck Repository" as DeckRepo
        component "Card Repository" as CardRepo
        component "Progress Repository" as ProgressRepo
    }
    
    component "Entity Framework Core" as EFCore {
        component "DbContext" as DbContext
        component "Migrations" as Migrations
    }
}

' ============================================
' DATA STORAGE LAYER (Database)
' ============================================
database "Database" as Database #LightGray {
    storage "SQLite / PostgreSQL" as DB {
        component "AspNetUsers Table" as UsersTable
        component "Decks Table" as DecksTable
        component "Cards Table" as CardsTable
        component "Progress Table" as ProgressTable
    }
}

' ============================================
' RELATIONSHIPS - Frontend to Backend
' ============================================
HomeComp -down-> DeckService : uses
DeckComp -down-> DeckService : uses
DeckComp -down-> CardService : uses
CreateDeckComp -down-> DeckService : uses
StatsComp -down-> ProgressService : uses
LearningComp -down-> CardService : uses
LearningComp -down-> ProgressService : uses

DeckService -down-> WebAPI : HTTP/REST
CardService -down-> WebAPI : HTTP/REST
ProgressService -down-> WebAPI : HTTP/REST
AuthService -down-> WebAPI : HTTP/REST

' ============================================
' RELATIONSHIPS - Backend to Business Logic
' ============================================
UsersCtrl -down-> UserService : calls
DecksCtrl -down-> DeckServiceBL : calls
CardsCtrl -down-> CardServiceBL : calls
ProgressCtrl -down-> ProgressServiceBL : calls
ProgressCtrl -down-> LearningAlgo : uses

' ============================================
' RELATIONSHIPS - Business Logic to Data Access
' ============================================
UserService -down-> UserRepo : uses
DeckServiceBL -down-> DeckRepo : uses
CardServiceBL -down-> CardRepo : uses
ProgressServiceBL -down-> ProgressRepo : uses
LearningAlgo -down-> ProgressRepo : reads/writes

UserService -down-> UserModel : manages
DeckServiceBL -down-> DeckModel : manages
CardServiceBL -down-> CardModel : manages
ProgressServiceBL -down-> ProgressModel : manages

' ============================================
' RELATIONSHIPS - Data Access to Database
' ============================================
UserRepo -down-> DbContext : uses
DeckRepo -down-> DbContext : uses
CardRepo -down-> DbContext : uses
ProgressRepo -down-> DbContext : uses

DbContext -down-> DB : queries/updates

' ============================================
' LEGEND
' ============================================
legend right
    **MVC Pattern Mapping:**
    |= Layer |= MVC Component |
    | Frontend (Blue) | **View** - User Interface |
    | Backend Controllers (Green) | **Controller** - Request Handler |
    | Business Logic (Yellow) | **Model** - Business Rules & Data |
    | Data Access (Red) | **Model** - Data Persistence |
    | Database (Gray) | **Model** - Data Storage |
    
    **Communication:**
    - Frontend ↔ Backend: REST API (HTTP/JSON)
    - Backend ↔ Database: Entity Framework Core
    - All layers follow dependency inversion principle
endlegend

@enduml
