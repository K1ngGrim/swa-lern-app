<main class="page-content">
  <div class="content-container">
    <h1>{{ 'DECK_LIST.TITLE' | translate }}</h1>

    <div class="scrollable-content">
      <!-- Loading State -->
      @if (isLoading()) {
        <div class="loading">
          {{ 'DECK_LIST.LOADING' | translate }}
        </div>
      }

      <!-- Error State -->
      @if (error()) {
        <div class="alert alert-error">
          {{ error() | translate }}
        </div>
      }

      <!-- Empty State -->
      @if (!isLoading() && !error() && decks().length === 0) {
        <div class="empty-state">
        <svg viewBox="0 0 24 24" width="64" height="64" class="empty-icon">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
        </svg>
        <h2>{{ 'DECK_LIST.NO_DECKS_TITLE' | translate }}</h2>
        <p>{{ 'DECK_LIST.NO_DECKS_MESSAGE' | translate }}</p>
        <button (click)="createNewDeck()" class="create-btn">
          {{ 'DECK_LIST.CREATE_FIRST_DECK' | translate }}
        </button>
        </div>
      }

      <!-- Deck List -->
      @if (!isLoading() && !error() && decks().length > 0) {
        <div class="deck-list">
          @for (deck of decks(); track deck.deckId) {
            <div class="deck">
              <div class="deck-row">
                <div class="deck-info">
                  <h3 class="deck-name">{{ deck.name }}</h3>
                  @if (deck.description) {
                    <p class="deck-description">{{ deck.description }}</p>
                  }
                  <div class="deck-meta">
              <span class="meta-item">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                {{ 'DECK_LIST.CARD_COUNT' | translate: { count: deck.cardCount } }}
              </span>
                    <span class="meta-item">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                      @if (getLastLearned(deck.lastLearned??null)) {
                        {{ 'DECK_LIST.LAST_STUDIED' | translate: { value: getLastLearned(deck.lastLearned??null) } }}
                      } @else {
                        {{ 'DECK_LIST.NEVER_STUDIED' | translate }}
                      }
              </span>
                  </div>
                </div>
                <div class="deck-actions">
                  <button
                    (click)="startLearning(deck.deckId)"
                    class="action-btn learn-btn"
                    [attr.aria-label]="'DECK_LIST.LEARN' | translate"
                    matTooltip="{{ 'DECK_LIST.LEARN' | translate }}"
                    matTooltipPosition="above"
                  >
                    <svg viewBox="0 0 24 24" width="18" height="18">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </button>
                  <button
                    (click)="editDeck(deck.deckId)"
                    class="action-btn edit-btn"
                    [attr.aria-label]="'DECK_LIST.EDIT' | translate"
                    matTooltip="{{ 'DECK_LIST.EDIT' | translate }}"
                    matTooltipPosition="above"
                  >
                    <svg viewBox="0 0 24 24" width="18" height="18">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="deck-heatmap">
                @if (this.heatmapData() | async; as statsMap) {
                  @if (statsMap.get(deck.deckId).length > 0) {
                    <app-learning-heatmap [statistics]="statsMap.get(deck.deckId)"></app-learning-heatmap>
                  }
                }
              </div>
            </div>


          }
        </div>
      }
    </div>
  </div>
</main>

